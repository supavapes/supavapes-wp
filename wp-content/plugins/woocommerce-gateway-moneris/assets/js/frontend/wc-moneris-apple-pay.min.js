"use strict";var _createClass=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(){function i(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}jQuery(document).ready(function(c){var _,t,r;function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.on_payment_authorized=t.on_payment_authorized.bind(t),t.do_transaction=t.do_transaction.bind(t),t.create_order=t.create_order.bind(t),t.process_receipt=t.process_receipt.bind(t),t.create_order_nonce=e.create_order_nonce,t.process_receipt_nonce=e.process_receipt_nonce,t.debug_log=e.debug_log,t}function o(e){_classCallCheck(this,o);e=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return e.attach_update_events=e.attach_update_events.bind(e),e.type="cart",e.ui_element=c("form.woocommerce-cart-form").parents("div.woocommerce"),e}function a(e){_classCallCheck(this,a);e=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return e.attach_update_events=e.attach_update_events.bind(e),e.type="checkout",e.ui_element=c("form.woocommerce-checkout"),e.buttons=".sv-wc-apply-pay-checkout",e}function s(e){_classCallCheck(this,s);e=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));return e.type="product",e.ui_element=c("form.cart"),e}return _=window.WC_Moneris_Apple_Pay_Handler=(_inherits(n,SV_WC_Apple_Pay_Handler_v5_12_1),_createClass(n,[{key:"on_payment_authorized",value:function(t){var r=this;return i(this,_),this.create_order(t.payment).then(function(e){return r.do_transaction(e,t.payment)},function(e){return r.set_payment_status(!1),r.fail_payment("Payment could not be processed. "+e.message)})}},{key:"do_transaction",value:function(t,e){var r,n=this;return i(this,_),e={orderId:t.number,payment:e,Amount:t.amount},r=t.perform_charge?"purchase":"preauth",this.log(e),window.MonerisApplePay[r](e,function(e){return n.log(e),n.process_receipt(t.id,e).then(function(e){return n.set_payment_status(!0),n.complete_purchase(e)},function(e){return n.set_payment_status(!1),n.fail_payment("Payment could not be processed. "+e.message)})})}},{key:"create_order",value:function(n){var o=this;return i(this,_),new Promise(function(t,r){var e={action:"wc_moneris_apple_pay_create_order",nonce:o.create_order_nonce,payment:JSON.stringify(n)};return c.post(o.ajax_url,e,function(e){return(e.success?t:r)(e.data)})})}},{key:"process_receipt",value:function(n,o){var a=this;return i(this,_),new Promise(function(t,r){var e={action:"wc_moneris_apple_pay_process_receipt",nonce:a.process_receipt_nonce,order_id:n,receipt:o};return c.post(a.ajax_url,e,function(e){return(e.success?t:r)(e.data)})})}},{key:"log",value:function(e){if(this.debug_log)return console.log(e)}}]),n),c(document.body).trigger("wc_moneris_apple_pay_handler_loaded"),t=window.WC_Moneris_Apple_Pay_Cart_Handler=(_inherits(o,WC_Moneris_Apple_Pay_Handler),_createClass(o,[{key:"attach_update_events",value:function(){var e=this;return i(this,t),c(document.body).on("updated_cart_totals",function(){return e.reset_payment_request()})}}]),o),c(document.body).trigger("wc_moneris_apple_pay_cart_handler_loaded"),r=window.WC_Moneris_Apple_Pay_Checkout_Handler=(_inherits(a,WC_Moneris_Apple_Pay_Handler),_createClass(a,[{key:"attach_update_events",value:function(){var e=this;return i(this,r),c(document.body).on("updated_checkout",function(){return e.reset_payment_request()})}}]),a),c(document.body).trigger("wc_moneris_apple_pay_checkout_handler_loaded"),window.WC_Moneris_Apple_Pay_Product_Handler=(_inherits(s,WC_Moneris_Apple_Pay_Handler),s),c(document.body).trigger("wc_moneris_apple_pay_product_handler_loaded")})}.call(void 0);