"use strict";var _createClass=function(){function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}jQuery(function(r){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e)),o=(t.ticketNumber=t.hasTicketNumber()?t.getTicketField().val():"",t.environment=e.environment,t.isCheckoutLoggingEnabled=e.isCheckoutLoggingEnabled,t.isPayPageEnabled=e.isPayPageEnabled,t.clearErrors=r("form.checkout").length,t);return r("#wc-moneris-csc_field").hide(),t.formInitialized||r("form.checkout").length||(o.ticketNumber?o.initForm():t.showErrorMessage("-pay-page"),t.placeOrderButtonHandling(),t.handleCSCForSavedCards()),r(document).on("updated_checkout",function(){o.initializingForm=!1,o.ticketNumber=t.hasTicketNumber()?t.getTicketField().val():"",t.placeOrderButtonHandling(),t.handleCSCForSavedCards(),o.ticketNumber?o.initForm():t.showErrorMessage(),t.isCheckoutLoggingEnabled&&t.woocommerceError&&r(".woocommerce-NoticeGroup").prepend(t.woocommerceError)}),r("form.checkout").length&&r(document).on("change","#customer_details input, #customer_details select, #terms",function(){"wc-moneris-ticket"===r(this).attr("name")||"createaccount"===r(this).attr("name")||o.isPayPageEnabled||r(document.body).trigger("update_checkout")}),r(document).on("checkout_error",function(){t.isCheckoutLoggingEnabled&&(t.woocommerceError=0<r(".woocommerce-error").length?r(".woocommerce-error")[0].outerHTML:""),r("body").trigger("update_checkout")}),window.recaptchaSuccessCallback=function(){grecaptcha.getResponse()&&(t.unblockMonerisForm(),window.recaptchaInterval=setInterval(function(){r("#wc-moneris-credit-card-checkout-form .blockUI.blockOverlay").length?clearInterval(window.recaptchaInterval):o.greCaptchaHandling()},1e3))},t}window.WC_Moneris_Payment_Form_Handler=(_inherits(n,SV_WC_Payment_Form_Handler_v5_12_1),_createClass(n,[{key:"hasTicketNumber",value:function(){return this.getTicketField().val()&&0<this.getTicketField().val().length}},{key:"handleCSCForSavedCards",value:function(){this.toggleCSCField(),r("input.js-wc-moneris-payment-token").change(this.toggleCSCField)}},{key:"toggleCSCField",value:function(){var e=r("input.js-wc-moneris-payment-token:checked").val(),t=r("div.js-wc-moneris-new-payment-method-form"),o=r("#wc-moneris-csc_field");o.length&&(e?(t.slideUp(200),o.removeClass("form-row-last").slideDown(200)):(t.slideDown(200),o.slideUp(200)))}},{key:"getTicketField",value:function(){return r("#wc-"+this.id_dasherized+"-ticket")}},{key:"showErrorMessage",value:function(){r("#wc-"+this.id_dasherized+"-error-message"+(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"")).show()}},{key:"validate_card_data",value:function(){var e,t;return!(r("form.checkout").is(".processing")||r("input.js-wc-moneris-payment-token:checked").val()&&(e=[],void 0!==(t=r(".payment_method_moneris").find("#wc-moneris-csc").val())&&(t?(/\D/.test(t)&&e.push(sv_wc_payment_gateway_payment_form_params.cvv_digits_invalid),(t.length<3||4<t.length)&&e.push(sv_wc_payment_gateway_payment_form_params.cvv_length_invalid)):e.push(sv_wc_payment_gateway_payment_form_params.cvv_missing)),0<e.length)&&(this.render_errors(e),1))}},{key:"do_inline_credit_card_validation",value:function(){}},{key:"handleError",value:function(e){this.debugLog("error occurred")}},{key:"initForm",value:function(){var t=this;this.initializingForm||(this.initializingForm=!0,this.monerisForm=new monerisCheckout,this.monerisForm.setCheckoutDiv("wc-"+this.id_dasherized+"-credit-card-checkout-form"),this.monerisForm.setMode(this.environment),this.togglePlaceOrderButton(),r("#wc-moneris-container").hide(),this.monerisForm.startCheckout(this.ticketNumber),this.monerisForm.setCallback("page_loaded",function(e){t.initializingForm=!1,t.formInitialized=!0,r("#wc-moneris-container").show(),t.handlePaymentFormReady(e),t.termsCheckboxHandling(),t.clearErrors=!0}),this.monerisForm.setCallback("error_event",function(e){t.handleError(e)}),this.monerisForm.setCallback("payment_complete",function(e){t.clearErrors=!1;e=JSON.parse(e);"001"===e.response_code&&(t.getTicketField().val(e.ticket),t.form.submit())}))}},{key:"handlePaymentFormReady",value:function(e){e.type&&"ready"===e.type?this.debugLog("Payment form ready"):this.debugLog(e),this.form.unblock()}},{key:"termsCheckboxHandling",value:function(){var e,t=this;this.greCaptchaHandling(),r("body.woocommerce-order-pay").length&&r("#terms").length&&(e="Please read and accept the terms and conditions below to proceed with your order.",r("#terms:checked").val()||this.blockMonerisForm(e),r(document).on("change","#terms",function(){"on"===r("#terms:checked").val()?t.unblockMonerisForm():t.blockMonerisForm(e)}))}},{key:"greCaptchaHandling",value:function(){if((r("#g-recaptcha-checkout-i13").length||r("#g-recaptcha-payment-method").length)&&r("#wc-moneris-credit-card-checkout-form-Frame").length){var t="Please verify captcha below to proceed with your order.";try{grecaptcha&&!grecaptcha.getResponse()&&this.blockMonerisForm(t)}catch(e){this.blockMonerisForm(t)}}}},{key:"blockMonerisForm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";r("#wc-moneris-credit-card-checkout-form").block({css:{width:"80%"},message:e})}},{key:"unblockMonerisForm",value:function(){r("#wc-moneris-credit-card-checkout-form").unblock(),this.termsCheckboxHandling()}},{key:"debugLog",value:function(e){this.isLoggingEnabled&&console.log(e)}},{key:"userHasSavedPaymentMethods",value:function(){return 0<r('[name="wc-moneris-payment-token"]').length}},{key:"placeOrderButtonHandling",value:function(){var e=this;r('[name="wc-moneris-payment-token"]').on("change",function(){""===r('[name="wc-moneris-payment-token"]:checked').val()&&e.hasTicketNumber()?(e.clearErrors&&r(".woocommerce-error").remove(),r("#place_order").attr("disabled",!0),r("#wc-moneris-tokenize-payment-method").parent().show()):(r("#place_order").attr("disabled",!1),r("#wc-moneris-tokenize-payment-method").parent().hide()),e.termsCheckboxHandling()}).change(),r('input[name^="payment_method"]').on("change",function(){e.togglePlaceOrderButton()})}},{key:"togglePlaceOrderButton",value:function(){"moneris"===r("input[name=payment_method]:checked").val()?this.userHasSavedPaymentMethods()?r('[name="wc-moneris-payment-token"]').change():this.hasTicketNumber()?(this.clearErrors&&r(".woocommerce-error").remove(),r("#place_order").attr("disabled",!0),r("#wc-moneris-tokenize-payment-method").parent().show()):(r("#place_order").attr("disabled",!1),r("#wc-moneris-tokenize-payment-method").parent().hide()):r("#place_order").attr("disabled",!1),this.termsCheckboxHandling()}}]),n),r(document.body).trigger("wc_moneris_payment_form_handler_loaded")});var woo_login_checkout_recaptcha_verified=function(){window.recaptchaSuccessCallback()},add_payment_method_recaptcha_verified=function(){window.recaptchaSuccessCallback()},woo_guest_checkout_recaptcha_verified=function(){window.recaptchaSuccessCallback()};